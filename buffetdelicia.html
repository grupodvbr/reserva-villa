<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Buffet ‚Ä¢ Del√≠cia Gourmet</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --primary:#ff6a00;
  --primary-600:#f97316;
  --primary-700:#ea580c;
  --bg:#f5f7fb;
  --card:#ffffff;
  --border:#e5e7eb;
  --muted:#6b7280;
  --text:#0f172a;
  --success:#16a34a;
  --danger:#dc2626;
  --warning:#f59e0b;
  --radius:18px;
  --radius-sm:12px;
  --shadow-sm:0 6px 18px rgba(0,0,0,.06);
  --shadow-md:0 12px 30px rgba(0,0,0,.10);
  --shadow-lg:0 24px 60px rgba(0,0,0,.18);
}

/* =========================
   RESET & BASE
========================= */
*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html, body{
  width:100%;
  height:100%;
  margin:0;
  font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:var(--text);
  background:
    radial-gradient(1200px 400px at 10% -10%, rgba(255,106,0,.08), transparent 40%),
    linear-gradient(180deg,#fff,var(--bg));
}
body{ overflow:hidden; }

/* =========================
   APP LAYOUT
========================= */
.app{
  max-width:1440px;
  height:100dvh;
  margin:0 auto;
  padding:16px 16px 18px;
  display:flex;
  flex-direction:column;
  gap:14px;
  overflow:hidden;
}

/* =========================
   HEADER
========================= */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.title{
  font-size:22px;
  font-weight:900;
  letter-spacing:.2px;
}
.badge{
  background:linear-gradient(180deg,#0f172a,#020617);
  color:#fff;
  padding:6px 12px;
  border-radius:999px;
  font-size:12px;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.1);
}

/* =========================
   CARDS
========================= */
.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow-md);
  padding:14px 14px 16px;
  border:1px solid #eef2f7;
  min-height:0;
}
.card b{
  font-weight:900;
  letter-spacing:.2px;
}

/* =========================
   COMPANY ROW
========================= */
.company-row{
  display:flex;
  align-items:center;
  gap:10px;
}
.company-row b{ white-space:nowrap; }
.company-row select{ flex:1; }

/* =========================
   FORM
========================= */
.form-grid{
  display:grid;
  grid-template-columns: 2.2fr 1fr 1fr 1fr 1fr;
  gap:12px;
  align-items:end;
}
.field{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.field label{
  font-size:11px;
  font-weight:800;
  color:#374151;
  text-transform:uppercase;
  letter-spacing:.4px;
}
input, select, button{
  height:48px;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid var(--border);
  background:#fff;
  font-size:15px;
  color:var(--text);
  outline:none;
  transition:border .15s, box-shadow .15s, transform .05s;
}
input::placeholder{ color:#9ca3af; }
input:focus, select:focus{
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(255,106,0,.18);
}
.input-weight{
  font-weight:900;
  letter-spacing:.02em;
}
.input-tara{
  background:#fff7ed;
  border-color:#fed7aa;
}
.net-preview{
  font-size:12px;
  color:#475569;
}
.net-preview b{ color:var(--success); }

button.primary{
  background:linear-gradient(180deg,var(--primary),var(--primary-700));
  color:#fff;
  border:none;
  font-weight:900;
  letter-spacing:.3px;
  box-shadow:0 10px 20px rgba(255,106,0,.25), inset 0 1px 0 rgba(255,255,255,.25);
}
button.primary:hover{ filter:brightness(1.04); }
button.primary:active{ transform:translateY(1px) scale(.99); }

button.ghost{
  background:#fff;
  border:1px dashed var(--border);
  color:#0f172a;
}
button.ghost:hover{ background:#f8fafc; }

small{ color:var(--muted); }

/* =========================
   LIST / ITEMS
========================= */
.card.lancamentos,
.card:last-of-type{
  display:flex;
  flex-direction:column;
  flex:1;
  min-height:0;
}

.list{
  flex:1;
  overflow:auto;
  display:grid;
  gap:10px;
  padding-right:6px;
}
.list::-webkit-scrollbar{ width:8px; }
.list::-webkit-scrollbar-thumb{
  background:#cbd5e1;
  border-radius:999px;
}
.item{
  display:grid;
  grid-template-columns:1fr auto;
  gap:12px;
  padding:12px 12px 12px 14px;
  border-radius:14px;
  border:1px solid var(--border);
  background:
    linear-gradient(180deg,#fff,#fbfdff);
  transition:.15s ease;
}
.item:hover{
  transform:translateY(-1px);
  box-shadow:0 10px 22px rgba(0,0,0,.10);
}
.item .name{
  font-weight:900;
  letter-spacing:.2px;
}
.meta{
  font-size:13px;
  color:#64748b;
}
.meta b{
  color:#0f172a;
  font-weight:900;
}
.tag{
  display:inline-block;
  margin-top:6px;
  padding:6px 10px;
  border-radius:999px;
  font-size:11px;
  font-weight:900;
  letter-spacing:.3px;
}
.MONTAGEM{ background:#dcfce7; color:#166534; }
.REPOSICAO{ background:#e0f2fe; color:#075985; }
.RETIRADA{ background:#fee2e2; color:#991b1b; }
.DEVOLUCAO{ background:#fef3c7; color:#92400e; }

.icon-btn{
  border:1px solid var(--border);
  background:#fff;
  border-radius:12px;
  padding:8px;
  cursor:pointer;
  transition:background .12s, transform .05s, box-shadow .12s;
}
.icon-btn:hover{
  background:#f8fafc;
  box-shadow:0 6px 14px rgba(0,0,0,.08);
}
.icon-btn:active{ transform:scale(.96); }
.icon-btn.danger{
  border-color:#fecaca;
  color:#b91c1c;
}

/* =========================
   MODAL
========================= */
.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
  backdrop-filter: blur(2px);
}
.modal{
  width:100%;
  max-width:560px;
  background:#fff;
  border-radius:22px;
  padding:18px;
  box-shadow:var(--shadow-lg);
  animation:pop .15s ease-out;
}
@keyframes pop{
  from{ transform:scale(.96); opacity:.6; }
  to{ transform:none; opacity:1; }
}
.modal h3{ margin:0 0 8px 0; }
.modal .grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.modal .actions{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:12px;
}

/* =========================
   RESPONSIVO
========================= */
@media (max-width: 1100px){
  .form-grid{ grid-template-columns:1fr 1fr; }
}
@media (max-width: 720px){
  .app{ padding:10px; }
  .title{ font-size:20px; }
  .form-grid{ grid-template-columns:1fr; }
}

/* =========================
   SPINNER
========================= */
@keyframes spin{
  from{ transform:rotate(0deg); }
  to{ transform:rotate(360deg); }
}
</style>
</head>

<body>
<div class="app">

  <div class="header">
    <div class="title">üçΩÔ∏è Buffet ‚Ä¢ Del√≠cia Gourmet</div>
    <span class="badge">Hoje: <b id="dataHoje"></b></span>
  </div>

  <!-- Sele√ß√£o de empresa -->
  <div class="card company-row">
    <b>Empresa:</b>
    <select id="empresaSelect">
      <option value="DEL√çCIA GOURMET">Del√≠cia Gourmet</option>
    </select>
  </div>

  <div class="card">
<div class="form-grid">
  <div class="field">
    <label>Prato</label>
    <input id="produto" placeholder="Digite o prato (busca + cadastra)" list="produtosList">
  </div>

  <div class="field">
    <label>Peso bruto (kg)</label>
    <input id="quantidade" class="input-weight" inputmode="decimal" placeholder="0,000">
  </div>

  <div class="field">
    <label>Tara (kg)</label>
    <input id="tara" class="input-tara" inputmode="decimal" placeholder="0,000">
    <div class="net-preview" id="pesoLiquidoPreview">L√≠quido: <b>0,000 kg</b></div>
  </div>

  <div class="field">
    <label>Unidade</label>
    <select id="unidade">
      <option value="KG">KG</option>
      <option value="UN">UN</option>
    </select>
  </div>

  <div class="field">
    <label>Tipo</label>
    <select id="tipo">
      <option value="MONTAGEM">Montagem</option>
      <option value="REPOSICAO">Reposi√ß√£o</option>
      <option value="RETIRADA">Retirada</option>
      <option value="DEVOLUCAO">Desperd√≠cio</option>
    </select>
  </div>
</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
      <button class="primary" id="btnSalvar"><i class="ri-save-3-line"></i> Salvar</button>
      <button class="ghost" id="btnLimpar"><i class="ri-eraser-line"></i> Limpar</button>
    </div>
    <small>Data √© travada no dia atual e hora √© autom√°tica.</small>
  </div>

<div class="card" style="display:flex; flex-direction:column; min-height:0;">
  <b>üìã Lan√ßamentos de Hoje</b>
  <div class="list" id="lista"></div>
</div>
<!-- üî¢ RESUMO DE VENDAS DO DIA -->
<div class="card" id="resumoVendasCard">
  <b>üìä Resumo de Vendas do Dia</b>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px">
    <div class="field">
      <label>Total de Vendas (R$)</label>
      <input id="totalVendasDia" class="input-weight" readonly value="0,00">
    </div>
    <div class="field">
      <label>Quantidade de Vendas</label>
      <input id="qtdVendasDia" class="input-weight" readonly value="0">
    </div>
  </div>
</div>

<!-- üßæ REGISTRAR VENDAS DO DIA -->
<div class="card" id="registrarVendasCard">
  <b>üßæ Registrar Vendas do Dia</b>
  <div class="form-grid" style="margin-top:10px">
    <div class="field">
      <label>Total vendido hoje (R$)</label>
      <input id="inputTotalVendasDia" inputmode="decimal" placeholder="0,00">
    </div>
    <div class="field">
      <label>Quantidade de vendas</label>
      <input id="inputQtdVendasDia" inputmode="numeric" placeholder="0">
    </div>
    <div class="field">
      <button class="primary" id="btnSalvarVendasDia">
        <i class="ri-save-3-line"></i> Salvar vendas do dia
      </button>
    </div>
  </div>
  <small>Esse valor fica salvo como o √∫ltimo registro do dia.</small>
</div>
</div>

<datalist id="produtosList"></datalist>

<!-- MODAL DE EDI√á√ÉO -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <h3>‚úèÔ∏è Editar lan√ßamento</h3>
    <div class="grid">
      <input id="editQuantidade" type="number" step="0.001" placeholder="Quantidade">
      <select id="editUnidade">
        <option value="KG">KG</option>
        <option value="UN">UN</option>
      </select>
      <select id="editTipo" style="grid-column:1/-1">
        <option value="MONTAGEM">Montagem</option>
        <option value="REPOSICAO">Reposi√ß√£o</option>
        <option value="RETIRADA">Retirada</option>
        <option value="DEVOLUCAO">Desperd√≠cio</option>
      </select>
    </div>
    <div class="actions">
      <button class="ghost" onclick="fecharModal()">Cancelar</button>
      <button class="primary" onclick="confirmarEdicao()">Salvar altera√ß√µes</button>
    </div>
  </div>
</div>

<script>
  const sb = window.supabase.createClient(
    "https://dxkszikemntfusfyrzos.supabase.co",
    "sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed"
  );

  const produtoInput = document.getElementById("produto");
  const quantidadeInput = document.getElementById("quantidade");
  const taraInput = document.getElementById("tara");
  const unidadeSelect = document.getElementById("unidade");
  const tipoSelect = document.getElementById("tipo");
  const lista = document.getElementById("lista");
  const btnSalvar = document.getElementById("btnSalvar");
  const btnLimpar = document.getElementById("btnLimpar");
  const empresaSelect = document.getElementById("empresaSelect");
btnSalvar.onclick = salvar;
btnLimpar.onclick = limpar;
// ================== CONFIGURA√á√ïES DE TARA POR TIPO ==================
const TARA_REPOSICAO = 0.280;

// restaura √∫ltimo tipo selecionado
const tipoSalvo = localStorage.getItem("buffet_tipo_selecionado");
if (tipoSalvo) {
  tipoSelect.value = tipoSalvo;
}
// aplica tara 0,280 ao abrir se √∫ltimo tipo foi reposi√ß√£o
if (tipoSelect.value === "REPOSICAO") {
  taraInput.value = formatPeso(0.280);
  atualizarLiquidoPreview();
}
// aplica tara autom√°tica quando muda o tipo
tipoSelect.addEventListener("change", () => {
  const tipo = tipoSelect.value;

  // salva o tipo no navegador
  localStorage.setItem("buffet_tipo_selecionado", tipo);

  // se for reposi√ß√£o, for√ßa tara 0,280 (mas deixa editar)
  if (tipo === "REPOSICAO") {
    taraInput.value = formatPeso(TARA_REPOSICAO);
    atualizarLiquidoPreview();
  }
});


  
// ================== TARA PADR√ÉO POR PRODUTO ==================
produtoInput.addEventListener("input", onProdutoInput);
produtoInput.addEventListener("change", onProdutoChange);
produtoInput.addEventListener("blur", onProdutoChange);

async function aplicarTaraPadraoPorProduto(){
  const empresa = empresaSelect.value;
  const nome = produtoInput.value.trim().toUpperCase();
  const tipo = tipoSelect.value;

  if(!nome) return;

  // üëâ se for REPOSI√á√ÉO, N√ÉO altera a tara do produto
  if (tipo === "REPOSICAO") {
    return;
  }

  // 1Ô∏è‚É£ tenta buscar a √öLTIMA tara usada nos lan√ßamentos
  const { data:ultimoLanc } = await sb
    .from("buffet_lancamentos")
    .select("tara")
    .eq("empresa", empresa)
    .eq("produto_nome", nome)
    .not("tara", "is", null)
    .order("created_at", { ascending: false })
    .limit(1)
    .maybeSingle();

  if (ultimoLanc?.tara != null && Number(ultimoLanc.tara) > 0) {
    taraInput.value = formatPeso(ultimoLanc.tara);
    atualizarLiquidoPreview();
    return;
  }

  // 2Ô∏è‚É£ fallback: busca tara padr√£o do produto
  const { data:prod } = await sb
    .from("buffet_produtos")
    .select("tara_padrao")
    .eq("empresa", empresa)
    .eq("nome", nome)
    .maybeSingle();

  if(prod?.tara_padrao != null && Number(prod.tara_padrao) > 0){
    taraInput.value = formatPeso(prod.tara_padrao);
    atualizarLiquidoPreview();
  }
}
  const hoje = new Date();
  const dataISO = hoje.toISOString().slice(0,10);
  const dataBR = hoje.toLocaleDateString("pt-BR");
  document.getElementById("dataHoje").innerText = dataBR;

  let editId = null;


function onProdutoInput(){
  const nome = produtoInput.value.trim();

  // se apagar o nome do prato, limpa tara
  if(!nome){
    taraInput.value = "";
    atualizarLiquidoPreview();
    return;
  }
}

function onProdutoChange(){
  const nome = produtoInput.value.trim();

  if(!nome){
    taraInput.value = "";
    atualizarLiquidoPreview();
    return;
  }

  aplicarTaraPadraoPorProduto();
}





  
  async function carregarProdutos(){
    const empresa = empresaSelect.value;
    const { data } = await sb
      .from("buffet_produtos")
      .select("nome")
      .eq("empresa", empresa)
      .order("nome");

    const list = document.getElementById("produtosList");
    list.innerHTML = "";
    data?.forEach(p=>{
      const o = document.createElement("option");
      o.value = p.nome;
      list.appendChild(o);
    });
  }

  async function carregarLancamentos(){
    const empresa = empresaSelect.value;
    const { data } = await sb
      .from("buffet_lancamentos")
      .select("*")
      .eq("empresa", empresa)
      .eq("data", dataISO)
      .order("created_at", { ascending:false });

    lista.innerHTML = "";
    data?.forEach(l=>{
      lista.innerHTML += `
        <div class="item">
          <div>
            <div class="name">${l.produto_nome}</div>
<div class="meta">
  Bruto: <b>${formatPeso((Number(l.quantidade) + Number(l.tara || 0)))} kg</b>
  ‚Ä¢ Tara: <b>${formatPeso(l.tara || 0)} kg</b>
  ‚Ä¢ L√≠quido: <b>${formatPeso(l.quantidade)} kg</b>
  ‚Ä¢ ${l.hora}
</div>            <span class="tag ${l.tipo}">${l.tipo}</span>
          </div>
          <div style="display:flex;gap:8px">
            <button class="icon-btn" onclick="abrirModal('${l.id}', ${l.quantidade}, '${l.unidade}', '${l.tipo}')">
              <i class="ri-edit-2-line"></i>
            </button>
            <button class="icon-btn danger" onclick="excluir('${l.id}')">
              <i class="ri-delete-bin-6-line"></i>
            </button>
          </div>
        </div>
      `;
    });
  }












  async function carregarResumoVendasDia(){
  const empresa = empresaSelect.value;

  // √∫ltimo registro do dia com vendas
  const { data } = await sb
    .from("buffet_lancamentos")
    .select("vendas")
    .eq("empresa", empresa)
    .eq("data", dataISO)
    .not("vendas", "is", null)
    .order("created_at", { ascending: false })
    .limit(1);

  document.getElementById("totalVendasDia").value =
    data?.length ? Number(data[0].vendas || 0).toFixed(2).replace(".", ",") : "0,00";

  // quantidade de vendas do dia (total de registros)
  const { count } = await sb
    .from("buffet_lancamentos")
    .select("*", { count: "exact", head: true })
    .eq("empresa", empresa)
    .eq("data", dataISO);

  document.getElementById("qtdVendasDia").value = count || 0;
}
async function salvar(){
  try{
    showSaving(); // üëà abre overlay

    const empresa = empresaSelect.value;
    const produtoNome = produtoInput.value.trim().toUpperCase();
    const pesoBruto = parsePeso(quantidadeInput.value);
    const tara = parsePeso(taraInput.value || 0);
    const unidade = unidadeSelect.value;
    const tipo = tipoSelect.value;

    if(!produtoNome || pesoBruto <= 0){
      alert("Preencha tudo");
      hideSaving();
      return;
    }
    if(tara > pesoBruto){
      alert("Tara n√£o pode ser maior que o peso bruto");
      hideSaving();
      return;
    }

    const quantidadeLiquida = Number((pesoBruto - tara).toFixed(3));

    let { data:prod } = await sb
      .from("buffet_produtos")
      .select("*")
      .eq("empresa", empresa)
      .eq("nome", produtoNome)
      .maybeSingle();

    if(!prod){
      const { data:nova } = await sb
        .from("buffet_produtos")
        .insert({ empresa, nome: produtoNome, unidade_padrao: unidade, tara_padrao: tara })
        .select().single();
      prod = nova;
      carregarProdutos();
    }

    const hora = new Date().toTimeString().slice(0,8);

    await sb.from("buffet_lancamentos").insert({
      empresa,
      produto_id: prod.id,
      produto_nome: produtoNome,
      tipo,
      quantidade: quantidadeLiquida,
      tara,
      unidade,
      data: dataISO,
      hora
    });

    const { data:ultimas } = await sb
      .from("buffet_lancamentos")
      .select("tara")
      .eq("produto_id", prod.id)
      .not("tara", "is", null)
      .order("created_at", { ascending:false })
      .limit(3);

// s√≥ atualiza tara padr√£o se N√ÉO for reposi√ß√£o
if(ultimas?.length && tipo !== "REPOSICAO"){
  const maisUsada = ultimas
    .map(x => Number(x.tara || 0))
    .sort((a,b) =>
      ultimas.filter(u=>u.tara===a).length -
      ultimas.filter(u=>u.tara===b).length
    )
    .pop();

  await sb.from("buffet_produtos")
    .update({ tara_padrao: maisUsada })
    .eq("id", prod.id);
}

    limpar();
    carregarLancamentos();

  } catch(err){
    console.error(err);
    alert("Erro ao salvar. Verifique a internet.");
  } finally {
    hideSaving(); // üëà fecha overlay sempre
  }
}


function showSaving(){
  document.getElementById("savingOverlay").style.display = "flex";
}
function hideSaving(){
  document.getElementById("savingOverlay").style.display = "none";
}
  function abrirModal(id, qtd, un, tipo){
    editId = id;
    document.getElementById("editQuantidade").value = qtd;
    document.getElementById("editUnidade").value = un;
    document.getElementById("editTipo").value = tipo;
    document.getElementById("modalBackdrop").style.display = "flex";
  }
  function fecharModal(){
    document.getElementById("modalBackdrop").style.display = "none";
    editId = null;
  }
  async function confirmarEdicao(){
    const qtd = parseFloat(document.getElementById("editQuantidade").value);
    const un = document.getElementById("editUnidade").value;
    const tipo = document.getElementById("editTipo").value;
    if(!qtd){ alert("Quantidade inv√°lida"); return; }

    await sb.from("buffet_lancamentos")
      .update({ quantidade:qtd, unidade:un, tipo })
      .eq("id", editId);

    fecharModal(); carregarLancamentos();
  }

  async function excluir(id){
    if(!confirm("Excluir esse lan√ßamento?")) return;
    await sb.from("buffet_lancamentos").delete().eq("id", id);
    carregarLancamentos();
  }

function limpar(){
  produtoInput.value = "";
  quantidadeInput.value = "";
  taraInput.value = "";
  unidadeSelect.value = "KG";

  // mant√©m o √∫ltimo tipo selecionado
  const tipoSalvo = localStorage.getItem("buffet_tipo_selecionado");
  tipoSelect.value = tipoSalvo || "MONTAGEM";

  // se for reposi√ß√£o, reaplica tara 0,280
  if (tipoSelect.value === "REPOSICAO") {
    taraInput.value = formatPeso(0.280);
  }

  atualizarLiquidoPreview();
}
carregarProdutos();
carregarLancamentos();
carregarResumoVendasDia();


function parsePeso(v){
  if(!v) return 0;
  return Number(String(v).replace(",", ".").replace(/[^\d.]/g, ""));
}

function formatPeso(v){
  return (Number(v || 0).toFixed(3)).replace(".", ",");
}

function atualizarLiquidoPreview(){
  const bruto = parsePeso(quantidadeInput.value);
const tara = parsePeso(taraInput.value);
  const liquido = Math.max(0, bruto - tara);
  document.getElementById("pesoLiquidoPreview").innerHTML =
    `L√≠quido: <b>${formatPeso(liquido)} kg</b>`;
}

function aplicarMascaraKg(input){
  let v = input.value || "";

  // mant√©m s√≥ n√∫meros
  v = v.replace(/\D/g, "");

  // garante 3 casas decimais
  if(v.length === 0) v = "000";
  if(v.length === 1) v = "00" + v;
  if(v.length === 2) v = "0" + v;

  const inteiro = v.slice(0, -3);
  const dec = v.slice(-3);

  input.value = (Number(inteiro) || 0) + "," + dec;
}

quantidadeInput.addEventListener("input", () => {
  aplicarMascaraKg(quantidadeInput);
  atualizarLiquidoPreview();
});

taraInput.addEventListener("input", () => {
  aplicarMascaraKg(taraInput);
  atualizarLiquidoPreview();
});

  document.getElementById("btnSalvarVendasDia").onclick = async () => {
  const empresa = empresaSelect.value;
  const total = Number(
    String(document.getElementById("inputTotalVendasDia").value)
      .replace(",", ".")
      .replace(/[^\d.]/g, "")
  );
  const qtd = Number(
    String(document.getElementById("inputQtdVendasDia").value)
      .replace(/[^\d]/g, "")
  );

  if(!total || total <= 0){
    alert("Informe o total de vendas do dia.");
    return;
  }

  await sb.from("buffet_lancamentos").insert({
    empresa,
    data: dataISO,
    vendas: total,
    quantidade: qtd || 0,
    tipo: "VENDAS_DIA",
    produto_nome: "TOTAL DO DIA",
    hora: new Date().toTimeString().slice(0,8)
  });

  document.getElementById("inputTotalVendasDia").value = "";
  document.getElementById("inputQtdVendasDia").value = "";

  carregarResumoVendasDia();
  alert("Vendas do dia registradas!");
};
</script>
<!-- OVERLAY DE SALVAMENTO -->
<div id="savingOverlay" style="
  position:fixed; inset:0; z-index:9999;
  background:rgba(15,23,42,.55);
  display:none; align-items:center; justify-content:center;
  backdrop-filter: blur(2px);
">
  <div style="
    background:#fff; padding:22px 26px; border-radius:16px;
    display:flex; align-items:center; gap:12px;
    box-shadow:0 12px 30px rgba(0,0,0,.25)
  ">
    <i class="ri-loader-4-line" style="
      font-size:26px; color:#ff6a00; animation:spin 1s linear infinite
    "></i>
    <b>Salvando...</b>
  </div>
</div>
</body>
</html>
